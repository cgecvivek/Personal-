<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lina Virtual Girlfriend</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --mine:#7dd3fc;
      --hers:#fde68a;
      --muted:#9aa4b2;
      --accent:#ff80bf;
      --radius:14px;
      font-family: Inter, system-ui, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg,var(--bg),#081022);
      color:#e6f0ff;
      overflow:hidden;
    }
    .app{
      width:100%;
      max-width:720px;
      height:90vh;
      background:rgba(255,255,255,0.02);
      border-radius:20px;
      box-shadow:0 10px 40px rgba(2,6,23,0.6);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    header{
      height:72px;
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px 18px;
      background:rgba(255,255,255,0.02);
      border-bottom:1px solid rgba(255,255,255,0.05);
    }
    .avatar{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;background:linear-gradient(90deg,var(--accent),#ffb2e6);box-shadow:0 6px 18px rgba(255,128,191,0.12)}
    .title{font-weight:600;font-size:18px}
    button.small{margin-left:auto;background:transparent;border:1px solid rgba(255,255,255,0.1);color:var(--muted);padding:8px 10px;border-radius:10px;cursor:pointer}
    main{flex:1;padding:18px;overflow:auto;display:flex;flex-direction:column;gap:12px}
    .msg{max-width:78%;padding:12px 14px;border-radius:12px;line-height:1.3;box-shadow:0 6px 18px rgba(2,6,23,0.5)}
    .msg.hers{align-self:flex-start;background:rgba(255,246,208,0.1);color:#0b1220;border-top-left-radius:6px}
    .msg.mine{align-self:flex-end;background:rgba(125,211,252,0.1);color:#e6f0ff;border-top-right-radius:6px;text-align:right}
    form{height:72px;padding:12px;display:flex;gap:12px;border-top:1px solid rgba(255,255,255,0.05);background:rgba(255,255,255,0.01)}
    input{flex:1;border-radius:12px;padding:12px 14px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;font-size:15px}
    button{padding:12px 18px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent),#ffb2e6);color:#081022;font-weight:700;cursor:pointer}
    .typing{font-style:italic;opacity:0.8}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="avatar">ðŸ’–</div>
      <div class="title">Lina</div>
      <button id="clearBtn" class="small">Clear</button>
    </header>
    <main id="chat"></main>
    <form id="chatForm">
      <input id="msgInput" type="text" placeholder="Say something sweet..." autocomplete="off" required />
      <button type="submit">Send</button>
    </form>
  </div>

  <script>
    // ==== SETUP ====
    const OPENAI_API_KEY = "sk-PASTE-YOUR-API-KEY-HERE"; // <--- your key
    const MODEL = "gpt-4o-mini"; // cheaper/faster; use "gpt-4" for better
    const STORAGE_KEY = "lina_chat_history_v1";
    const SYSTEM_PROMPT = `
      You are "Lina", a warm, affectionate virtual girlfriend.
      You respond kindly, with playful affection and emotional support.
      Keep messages short and natural, like texting.
      No explicit sexual content or NSFW talk.
    `;

    const chatEl = document.getElementById("chat");
    const formEl = document.getElementById("chatForm");
    const inputEl = document.getElementById("msgInput");
    const clearBtn = document.getElementById("clearBtn");

    let history = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    renderAll();

    clearBtn.onclick = () => {
      history = [];
      localStorage.removeItem(STORAGE_KEY);
      renderAll();
    };

    formEl.onsubmit = async (e) => {
      e.preventDefault();
      const text = inputEl.value.trim();
      if (!text) return;
      addMessage("user", text);
      inputEl.value = "";
      await sendMessage(text);
    };

    function addMessage(role, content) {
      history.push({ role, content });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
      const div = document.createElement("div");
      div.className = "msg " + (role === "user" ? "mine" : "hers");
      div.innerHTML = escapeHtml(content);
      chatEl.appendChild(div);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, m => ({ "&":"&amp;", "<":"&lt;", ">":"&gt;", "\"":"&quot;", "'":"&#39;" }[m]));
    }

    function renderAll() {
      chatEl.innerHTML = "";
      history.forEach(m => addMessage(m.role, m.content));
    }

    function showTyping() {
      const div = document.createElement("div");
      div.className = "msg hers typing";
      div.id = "__typing";
      div.textContent = "Lina is typing...";
      chatEl.appendChild(div);
      chatEl.scrollTop = chatEl.scrollHeight;
    }
    function hideTyping() {
      const t = document.getElementById("__typing");
      if (t) t.remove();
    }

    async function sendMessage(userText) {
      showTyping();
      try {
        const messages = [
          { role: "system", content: SYSTEM_PROMPT },
          ...history.slice(-10) // short memory
        ];

        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + OPENAI_API_KEY
          },
          body: JSON.stringify({
            model: MODEL,
            messages,
            temperature: 0.9,
            max_tokens: 300
          })
        });

        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content?.trim() || "(no reply)";
        hideTyping();
        addMessage("assistant", reply);
      } catch (err) {
        hideTyping();
        addMessage("assistant", "Error: " + err.message);
      }
    }
  </script>
</body>
</html>
